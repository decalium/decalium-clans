--- a/net/minecraft/util/CrudeIncrementalIntIdentityHashBiMap.java
+++ b/net/minecraft/util/CrudeIncrementalIntIdentityHashBiMap.java
@@ -16,19 +16,23 @@
     private K[] byId;
     private int nextId;
     private int size;
+    private java.util.BitSet usedIds; // Paper
 
     public CrudeIncrementalIntIdentityHashBiMap(int size) {
         size = (int)((float)size / 0.8F);
         this.keys = (K[])(new Object[size]);
         this.values = new int[size];
         this.byId = (K[])(new Object[size]);
+        this.usedIds = new java.util.BitSet(); // Paper
     }
 
+    @Override
     public int getId(@Nullable K entry) {
         return this.getValue(this.indexOf(entry, this.hash(entry)));
     }
 
     @Nullable
+    @Override
     public K byId(int index) {
         return (K)(index >= 0 && index < this.byId.length ? this.byId[index] : null);
     }
@@ -52,9 +56,13 @@
     }
 
     private int nextId() {
+        /* // Paper start
         while(this.nextId < this.byId.length && this.byId[this.nextId] != null) {
             ++this.nextId;
         }
+        */
+        this.nextId = this.usedIds.nextClearBit(0);
+        // Paper end
 
         return this.nextId;
     }
@@ -67,6 +75,7 @@
         this.byId = (K[])(new Object[newSize]);
         this.nextId = 0;
         this.size = 0;
+        this.usedIds.clear(); // Paper
 
         for(int i = 0; i < objects.length; ++i) {
             if (objects[i] != null) {
@@ -90,6 +99,7 @@
         this.keys[k] = value;
         this.values[k] = id;
         this.byId[id] = value;
+        this.usedIds.set(id); // Paper
         ++this.size;
         if (id == this.nextId) {
             ++this.nextId;
@@ -141,6 +151,7 @@
         throw new RuntimeException("Overflowed :(");
     }
 
+    @Override
     public Iterator<K> iterator() {
         return Iterators.filter(Iterators.forArray(this.byId), Predicates.notNull());
     }
@@ -150,6 +161,7 @@
         Arrays.fill(this.byId, (Object)null);
         this.nextId = 0;
         this.size = 0;
+        this.usedIds.clear(); // Paper
     }
 
     public int size() {
